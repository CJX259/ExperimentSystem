## 实验报告管理系统



### 路由安全方面：

> 前端通过cookie存储用户登录后在后台的sessionId。

> 若无cookie，无法直接进入主页面，会直接跳到/login页面。

> 若cookie时间已过，或者cookie被篡改，返回cookie认证错误，无法继续发起其他请求操作

> 切换路由中的参数通过state传递，url无法查看，保密性好。

> 通过直接输入url进入缺少参数的页面，跳回到/login页面。（利用路由的wrpeers配置实现）



### 用户体验方面：

> 每次进入layout页面，发送一次**cookie确认登录状态请求**，实现通过cookie拿到用户登录信息，**确保每个页面中就算刷新也一样能获得用户信息**。

> 点击路由中的**参数通过路由的state传递**，即使刷新页面也能保留上次数据，不必重新筛选。

> 学生列表的table中的节流函数设置间隔时间为**500毫秒**（测试得出此时间区间大概为用户鼠标移动到其他行的时间，因此当行的节流**基本不会影响**到其他行的异步函数触发，又能**限制了用户疯狂点击**某一按钮来占用网络资源）



### 性能优化方面：

> 首页渲染时，执行完loginByCookie接口，拿到老师数据后，再去请求课程信息和公告。
>
> 防止页面在未登录的情况下（即没有cookie信息），请求所有接口（*因为首页渲染需要请求课程信息*），导致一次报太多错误，以及浪费http请求。



> 某些便于按的按钮使用**节流方式**，防止用户疯狂点击导致占用网络资源




### 遇到的问题：

> #### 问题：封装节流函数，只有单个的按钮可以生效，给Table中的每行按钮绑定的话，无法生效
>
> **初步分析**：给按钮点击事件绑定的函数，在页面变化之后就会重新渲染，**重新执行节流函数，生成新的函数来绑定onclick事件**，导致**闭包里的timer标识重新初始化**。
> **分析判断**：通过测试给**下载按钮添加节流函数**后，得知分析正确，只有**不导致页面重新渲染的事件函数才能维持timer**，否则重新渲染后节流绑定重新绑定，导致timer重新初始化
>
> **处理方法**：使用state维护一个timer，table重新渲染，重新绑定onclick函数时就算重新执行了节流生成函数，也不会使timer重新初始化。（或维护一个timer数组，不过没有必要，因为数组的话就是给每一行设置单独的触发间隔，这样当用户不断点击不同的行时也无法达到预期的节流效果，而且**让代码的可读性和复杂性大幅提升，用户体验却没有很大提升**，所以没有必要）。



> #### 问题：首页的loginByCookie，等该异步函数执行完后再去请求课程信息等，无法实现按顺序请求
>
> **问题原因**：教师属性是存放在redux中，故loginByCookie是redux-saga实现的异步请求函数，请求成功后设置教师的值，但是在react页面中却无法得知何时请求完成。
>
> **初步思路（失败）**：在react页面中使用**两个useEffect方法**，利用loginByCookie后redux中**教师属性的变化**，实现教师属性变化后就请求课程
>
> **失败原因**：在开发环境能成功实现，但是打包后，在**服务器中运行时，在react页面就无法获取redux中的教师属性**了（添加的console语句，开发时可以打印教师属性，但打包后打印教师属性为空），故无法判断教师属性的变化来执行useEffect。
>
> **解决方法**：虽然在react页面无法得知何时执行完，但是在redux中是可以的，那么就设置课程模块，利用redux-saga能顺序执行异步的特性，在loginByCookie执行完后，执行课程模块的请求课程Effect即可解决。

